
/* 
   You can convert this graph to a PNG image with this command:

   dot -Tpng  Pageview_definition.dot  -o Pageview_definition.png

*/


digraph G {

     Legend [shape=none, margin="0,0", width=1, label=<
     <TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4">
      <TR>
       <TD><B>Legend</B></TD>
      </TR>
      <TR>
       <TD bgcolor="CornflowerBlue">Start state</TD>
      </TR>
      <TR>
       <TD bgcolor="red">Rejected state</TD>
      </TR>
      <TR>
       <TD bgcolor="green">Accepted state</TD>
      </TR>
      <TR>
       <TD bgcolor="gold">Decision state</TD>
      </TR>
     </TABLE>
    >];

   start                   [label="Get a squid log line",style=filled,color="CornflowerBlue" ];
   decision_status_code    [label="status code is 302,304,20x",style=filled,color="Gold"];
   decision_mimetype       [label="mimetype is one of: \ntext/html\ntext/vnd.wap\napplication/json",style=filled,color="Gold"];
   decision_bots           [label="ip isn't in bot ranges and UA doesn't contain one of these\n \"bot\"\n\"crawler\"\n\"google\"",style=filled,color="Gold"];
   decision_wikiproject    [label="url is like\nhttp(s)://(wikiproject).m.wikipedia.org/wiki/",
                            style=filled,color="Gold"
                           ];
   decision_method         [label="method is GET",style=filled,color="Gold"];
   decision_minimumfields  [label="has at least 9 fields",style=filled,color="Gold"];
   discard                 [label="entry is discarded",style=filled,color="Red"];
   accept                  [label="We have a pageview",style=filled,color="Green"];


   start                  -> decision_minimumfields;

   decision_minimumfields -> decision_status_code  [ label="yes"];
   decision_minimumfields -> discard               [ label="no"];

   decision_status_code   -> decision_bots         [ label="yes" ];
   decision_status_code   -> discard               [ label="no" ];

   decision_bots          -> decision_wikiproject  [label="yes"];
   decision_bots          -> discard               [label="no"];

   decision_wikiproject   -> decision_method       [label="yes"];
   decision_wikiproject   -> discard               [label="no"];

   decision_method        -> decision_mimetype     [label="yes"];
   decision_method        -> discard               [label="no"];

   decision_mimetype      -> accept                [label="yes"];
   decision_mimetype      -> discard               [label="no"];


};
